---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { SITE } from "@/config";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

// Import global CSS for hover effect
import "@/styles/global.css";

const title = "Exhibitions";
const description = "Exhibitions by Paul Graßl";
const exhibitions = (await getCollection("exhibitions"))
  .sort((a, b) => {
    // Parse the start date from the period field (format like "March 7 – March 13, 2025")
    const getStartDate = (period: string) => {
      const [startPart] = period.split("–").map(p => p.trim());
      const year = period.split(", ")[1];
      // Convert month name and day to a consistent date format
      const date = new Date(`${startPart}, ${year}`);
      return date;
    };
    
    const dateA = getStartDate(a.data.period);
    const dateB = getStartDate(b.data.period);
    // Sort in descending order (newest first)
    return dateB.getTime() - dateA.getTime();
  })
  .map(exhibition => {
    // Use the main image field for the exhibition overview page
    const mainImage = { src: exhibition.data.image, orientation: 'landscape' };
    
    return {
      ...exhibition,
      mainImage
    };
  });
---

<Layout title={title} description={description}>
	<Header />
	<main id="main-content">
		<section class="mx-auto w-full max-w-5xl px-6 py-8 flex flex-col">
			<h1 class="text-2xl font-normal leading-tight mb-12 text-foreground">Exhibitions</h1>
			{exhibitions.map(exhibition => (
				        <div class="w-full flex flex-col items-center mb-16">
				        <a href={`/exhibitions/${exhibition.data.slug}`} class={`group flex flex-col cursor-pointer ${exhibition.mainImage.orientation === 'portrait' ? 'items-center' : 'items-start w-full'}`}>
          <div class={`${exhibition.mainImage.orientation === 'portrait' ? 'aspect-[2/3] max-w-md' : 'w-full aspect-[3/2]'} bg-muted overflow-hidden`}>
            <Image 
              src={exhibition.mainImage.src} 
              alt={exhibition.data.title} 
              class="object-cover w-full h-full"
              width={exhibition.mainImage.orientation === 'portrait' ? 1280 : 1920}
              height={exhibition.mainImage.orientation === 'portrait' ? 1920 : 1280}
              quality={80}
              format="webp"
              densities={[1, 2]}
              loading="lazy"
            />
          </div>
          <div class={`mt-4 ${exhibition.mainImage.orientation === 'portrait' ? 'max-w-md text-center' : 'w-full'}`}>
            <h3 class="text-lg italic font-normal leading-tight transition-colors group-hover:text-accent">{exhibition.data.title}</h3>
            <div class="mt-0.5 flex flex-col gap-y-0.5 text-lg text-muted-foreground transition-colors group-hover:text-accent">
              <span>{exhibition.data.location}</span>
              <span>{exhibition.data.period}</span>
            </div>
          </div>
				</a>
				</div>
			))}
		</section>
	</main>
	<Footer />
</Layout> 