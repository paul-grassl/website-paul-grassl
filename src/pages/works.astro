---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { SITE } from "@/config";
import { getCollection } from "astro:content";

const title = "Works";
const description = "Artwork by Paul GraÃŸl";

// Get all works and organize by year
const allWorks = await getCollection("works");
const worksByYear = allWorks.reduce(
	(acc, work) => {
		const year = work.data.year;
		if (!acc[year]) {
			acc[year] = [];
		}
		acc[year].push(work);
		return acc;
	},
	{} as Record<number, typeof allWorks>
);

// Sort years in descending order
const sortedYears = Object.keys(worksByYear)
	.map(year => parseInt(year))
	.sort((a, b) => b - a);
---

<Layout title={title} description={description}>
	<Header />
	<main id="main-content">
		<section class="mx-auto flex w-full max-w-5xl flex-col px-6 py-8">
			<h1 class="mb-12 text-2xl leading-tight font-normal text-foreground">
				Works
			</h1>
			<div class="flex flex-col gap-8">
				{
					sortedYears.map(year => (
						<div class="w-full">
							<a
								href={`/works/${year}`}
								class="group flex cursor-pointer flex-col"
							>
								<h2 class="text-xl leading-tight font-normal transition-colors group-hover:text-accent">
									{year}
								</h2>
							</a>
						</div>
					))
				}
			</div>
		</section>
	</main>
	<Footer />
</Layout>

