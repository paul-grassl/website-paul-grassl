---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

// Load current exhibition and landing image data
const currentData = await getCollection("current");
const currentExhibition = currentData.find(entry => entry.id.includes("current-exhibition"));
const landingImage = currentData.find(entry => entry.id.includes("landing-image"));

// Check if current exhibition has content
const hasCurrentExhibition = currentExhibition && 
  currentExhibition.data.title && 
  currentExhibition.data.title.trim() !== "";
---

<Layout title="Paul Graßl" description="Artist Portfolio">
  <Header />
  <main id="main-content" data-layout="index">
    <section class="mx-auto w-full max-w-5xl px-6 py-8">
      <div class="flex flex-col gap-y-8">
        
        {hasCurrentExhibition && (
          <div class="w-full">
            <h1 class="text-2xl font-normal leading-tight mb-2 text-foreground">Current Calendar</h1>
            <div class="mt-4">
              <h2 class="text-lg font-normal text-foreground mb-1">{currentExhibition.data.title}</h2>
              <div class="text-base text-muted-foreground flex flex-col gap-y-0.5">
                {currentExhibition.data.locationUrl && currentExhibition.data.locationUrl.trim() !== "" ? (
                  <a 
                    href={currentExhibition.data.locationUrl} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="hover:text-foreground transition-colors underline decoration-1 underline-offset-2"
                  >
                    {currentExhibition.data.location}
                  </a>
                ) : (
                  <span>{currentExhibition.data.location}</span>
                )}
                {currentExhibition.data.type && (
                  <span>{currentExhibition.data.type}</span>
                )}
                {currentExhibition.data.period && (
                  <span>{currentExhibition.data.period}</span>
                )}
              </div>
            </div>
          </div>
        )}

        {landingImage && landingImage.data.image && (
          <div class="w-full">
            <div class="flex justify-center">
              <div class="max-w-xl w-full">
                <img 
                  src={landingImage.data.image}
                  alt={landingImage.data.alt || "Current artwork by Paul Graßl"}
                  class="w-full h-auto"
                />
                {landingImage.data.caption && landingImage.data.caption.trim() !== "" && (
                  <div class="mt-2 text-center">
                    <p class="text-base text-muted-foreground italic">{landingImage.data.caption}</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

      </div>
    </section>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
